{extend name="template/base" /}

{block name="style"}
	<link rel="stylesheet" type="text/css" href="/static/index/css/stu_page.css"/>
{/block}

{block name="content"}
	<div class="mui-content">
		<div id='head'>
			<div id='head_name'>体感互动教学管理系统</div>
			<div id='info_div'>
				<img src='/static/index/images/h.png'>
				<div>
					<span id='teacher'>张三</span>
					<br>
					<span id='college'>体育学院</span>
				</div>
			</div>
		</div><!--id="head" 结束-->
		<div id='notice'>
			<span id='show_notice'>{$notice}</span>
		</div>
		<div id='content'>
			<div id='lession_type' class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
				<div class="mui-scroll">
					{if isset($lession)}
					{volist name='list' id='v' key='k'}
						<a class="mui-control-item {if $k==1}mui-active{/if}">{$v}</a>
					{/volist}
					{else /} <span id='no_video'>暂无课程信息~</span>
					{/if}
				</div>
			</div><!--横向滚动 结束-->
			<div id='online_src'>
				<a href='http://tyb.nankai.edu.cn/2020/0110/c19344a263379/page.htm'><img src="/static/index/images/online_video.png"></a><a><img src="/static/index/images/online_cartoon.png"></a>
			</div>
			<div id='video_list'>
				{if isset($videos)}
				{volist name='videos' id='v'}
					<div class='video video_normal'><span class='activity' video='{$v.video}' pic='{$v.video_pic}'>{$v.video_name}</span></div>
				{/volist}
				{/if}
			</div><!--id='video_list' 结束 -->
		</div><!--id='content' 结束-->
		<div id='three_part'><!--每个动作的标准视频-本人练习-练习指导-->
			<span id='teacher_video'>标准视频</span><br><span id='my_exercise'>我的练习</span><br><span id='advice'>练习指导</span>
		</div>
		<div id='pop1' class="mui-popover mui-scroll">
			<div id='advice_content'>
				老师建议
			</div>
		</div>
	</div>
	<style>
		/*弹出层1 样式   ：写在score.css文件中不生效*/
		#pop1 { top: 88vw !important; left: 0 !important; position:fixed; width: 100vw; }
		#advice_content { width: 86vw; position: absolute; background-color: #fff;
			left: 7vw; overflow: scroll; max-height: 66vw; border-radius: 6px; }
		.mui-popover-arrow { display:none; }
		/*弹出层1 样式 结束*/
	</style>
{/block}
{block name="foot"}{/block}
{block name="script"}
	<script type="text/javascript">
		var ws = null;
		var stu_grade = "{$stu_grade}"; //年级
		var stu_class = "{$stu_class}"; //班级
		var stu_num = "{$stu_num}"; //学生号
		var stu_name = "{$stu_name}"; //学生姓名
		var type = "{$type}"; //类型（1 表示学生）
		var address = "{$ip}";//训练终端的ip
		
		var stu_data = '' + address + '_' + stu_num + '_' + stu_name + '_' + type + '_' + stu_grade + '_' + stu_class; //组装要发送的数据
	
		window.onload = connect(); //页面加载完成执行connect()
		
		//建立socket连接
		function connect ()
		{
			let socket_ip = 'ws://' + address + ':1822';
			
			ws=new WebSocket( socket_ip );
			
	        ws.onopen=function(e){
				ws.send('');//先发个空串 否则对方收不到
				ws.send(stu_data);
	        };
	        
	        ws.onmessage=function(e){
	           console.log(e.data);
	        };
	        
	        ws.onerror=function(e){
	           console.log(e);
	        };
	        
	        ws.onclose=function(e){
	            console.log('连接已关闭');
	        };
		}

		var video_list_e = $('#video_list');//课程所属的动作列表
		var active_name = ''; //存储每个动作名称
		var lesson_name = ''; //当前课程名称
		var videos = $('#video_list .video'); //当前课程的所有动作
		var three_part = $('#three_part');//标准视频-我的练习-指导建议

		//点击通知的 显示学生的通知页面
		$('#show_notice').click(function () {
			mui.toast('aaaa', { duration:'short', type:'div' }) ;
			window.location.href = '/index/notice/index?type=stu';
		})

		//点击课程导航时 隐藏标准视频-我的练习-指导建议 获取课程的动作数据
		$('#lession_type').on('click', 'a', function() {
			let t = $(this);
			let lesson = t.html();
		
			three_part.css('display', 'none');
		
			//执行ajax
			$.ajax({
				url:'/index/student/get_lesson',
				type: 'post',
				dataType: 'json',
				data: {lesson: lesson},
				success:function (info) {
					if (info.code == 200)
					{
						//将此课程的数据显示在页面
						let n = info.data.length;
						let str = '';

						for (let i = 0; i < n; i++)
						{
							str += "<div class='video video_normal'><span class='activity' video='"
								+ info.data[i].video + "' pic='"
								+ info.data[i].video_pic + "'>"
								+ info.data[i].video_name + "</span></div>";					
						}

						video_list_e.html(str);

					}else if(info.code == 100)
					{
						mui.toast(info.msg,{ duration:'short', type:'div' });
					}
				},
				error:function(){
					mui.toast('网络异常~',{ duration:'short', type:'div' });
				}
			})//ajax 结束
			
		})
		
		//课程 每个动作的点击事件
		//video_list_e.on('click', '.video', function () {
		$('#video_list').on('click', '.video', function () {
			//mui.toast('haha', { duration:'short', type:'div' });
			let t = $(this);
			
			t.siblings().removeClass('video_active');
			t.addClass('video_active');
			three_part.css('display','inline-block');
			active_name = $(this).find('span').html();
		})

		//显示 老师的指导建议
		$('#advice').click(function () {
			//显示老师给自己当前动作的建议
			/*$.ajax({
				url:'/index/index/show_advice',
				type:'post',
				data:{
					stu_num: stu_num,
					lesson: 
					}
			})//ajax 结束*/
			mui('#pop1').popover('show');
		})
	</script>
{/block}